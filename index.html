<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时视频语义传输算法设计(RTVST)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 原有CSS样式保持不变 */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        body{background:linear-gradient(135deg,#a1c4fd,#c2e9fb,#e0f7fa);color:#333;min-height:100vh}
        .container{max-width:1800px;margin:0 auto;padding:10px}
        header{text-align:center;padding:30px 0}
        h1{font-size:2.8rem;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.3)}
        .subtitle{font-size:1.5rem;opacity:.9;max-width:800px;margin:0 auto;line-height:1.6}
        .global-controls{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin:30px 0;text-align:center}
        
        .snr-selector {margin:20px 0;text-align:center}
        .snr-selector label{font-size:1.2rem;color:#000;margin-right:10px;font-weight:bold}
        .snr-selector select{padding:8px 15px;font-size:1rem;border:2px solid #fdbb2d;border-radius:8px;background:rgba(255,255,255,.9);color:#333;cursor:pointer;outline:none}
        .snr-selector select:hover{background:rgba(255,255,255,1)}
        
        .info-display-row{display:flex;justify-content:center;align-items:center;border:2px solid #ccc;border-radius:8px;padding:15px 0;margin:20px 0;background:rgba(255,255,255,.1);color:#000;gap:50px}
        .info-display-item{text-align:center;padding:5px 15px}
        .info-label{font-weight:bold;font-size:24px;color:#000;margin-right:5px}
        .info-value{font-size:26px;color:#8B0000;font-weight:600}
        
        .performance-charts{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:15px;padding:25px;margin:30px 0;box-shadow:0 10px 30px rgba(0,0,0,.2)}
        .charts-title{font-size:1.5rem;margin-bottom:20px;color:#fdbb2d;display:flex;align-items:center;gap:10px;justify-content:center}
        .charts-container{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
        .chart-item{background:rgba(255,255,255,.05);border-radius:10px;padding:15px;text-align:center;border:1px solid rgba(255,255,255,.1)}
        .chart-item img{border-radius:25px;width:100%;height:400px;object-fit:contain;background:rgba(0,0,0,.2);border-radius:15px;padding:25px;border:2px solid rgba(255,255,255,.3);box-shadow:0 6px 20px rgba(0,0,0,.3);transition:all 0.3s ease}
        .chart-item img:hover{transform:scale(1.03);box-shadow:0 10px 30px rgba(0,0,0,.4)}
        .chart-label{margin-top:10px;color:#fdbb2d;font-weight:500;font-size:1.3rem}
        .architecture-image{text-align:center;margin:25px 0;background:rgba(255,255,255,.08);backdrop-filter:blur(10px);border-radius:12px;padding:25px;border:1px solid rgba(253,187,45,.3);box-shadow:0 8px 25px rgba(0,0,0,.2)}
        .architecture-image img{max-width:90%;max-height:450px;object-fit:contain;border-radius:8px;border:1px solid rgba(255,255,255,.2);transition:transform .3s}
        .architecture-image img:hover{transform:scale(1.02)}
        .image-caption{margin-top:15px;color:#fdbb2d;font-weight:500;font-size:1.5rem}
        
        .video-container{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:30px}
        .video-panel{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:15px;padding:15px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:flex;flex-direction:column;min-width:0}
        .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.2)}
        .panel-title{font-size:1.2rem;display:flex;align-items:center;gap:8px}
        .panel-title i{color:#fdbb2d}
        .display-area{width:100%;height:200px;border:2px solid rgba(255,255,255,.2);border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);overflow:hidden;margin-bottom:12px}
        .display-area img{max-width:100%;max-height:100%;object-fit:contain}
        .controls{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;justify-content:center}
        .info-panel{background:rgba(0,0,0,.2);padding:10px;border-radius:8px;margin-top:8px;font-size:.8rem}
        .info-item{display:flex;justify-content:space-between;margin-bottom:4px}
        .status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
        .status-playing{background:#4CAF50;animation:pulse 1s infinite}
        .status-paused{background:#ff9800}
        .status-stopped{background:#f44336}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        footer{text-align:center;margin-top:50px;padding:20px;opacity:.7;font-size:.9rem}
        .btn{background:#fdbb2d;color:#1a1a2e;border:none;padding:8px 16px;border-radius:50px;font-weight:bold;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:6px;margin:4px;font-size:.85rem}
        .btn:hover{background:#ffcc44;transform:scale(1.05)}
        .btn-global{background:#4CAF50;padding:10px 20px;font-size:.95rem}
        .btn-global:hover{background:#66BB6A}
        .btn-stop{background:#f44336}
        .btn-stop:hover{background:#ef5350}
        @media(max-width:1400px){.video-container{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.video-container{grid-template-columns:1fr}h1{font-size:2.2rem}}

        .abstract{background:rgba(255,255,255,.08);padding:20px 30px;border-radius:10px;line-height:1.8;border-left:4px solid #fdbb2d;color:#000;font-size:1.2rem;font-weight:500;text-align:justify;text-justify:inter-ideograph;word-break:break-all}
        .abstract strong{color:#000;font-weight:600;font-size:1.2rem}

        .progress-bar-container{width:100%;height:8px;background:rgba(0,0,0,.5);border-radius:4px;margin-bottom:10px;overflow:hidden}
        .progress-bar{height:100%;width:0;background:linear-gradient(90deg,#fdbb2d,#ffcc44);transition:width 0.1s linear}
        .control-row{display:flex;align-items:center;gap:20px;justify-content:center;width:100%;margin:20px 0}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>实时视频语义传输算法设计</h1>
            <p class="subtitle">第一梯队</p>
        </header>

        <div class="global-controls">
            <div class="abstract" style="margin-bottom:20px;">
                <strong>项目摘要：</strong>
                语义通信作为6G关键技术，以其高压缩与强鲁棒性在图像、视频传输中展现出显著优势...
                <!-- 原有摘要内容 -->
            </div>

            <div class="architecture-image">
                <img src="https://rtvst-demo.github.io/video-transmission-demo/rtvst_Architecture.jpg" alt="RTVST架构图">
                <div class="image-caption">RTVST模型架构图</div>
            </div>
        </div>

        <div class="performance-charts">
            <div class="charts-title"><i class="fas fa-chart-line"></i> 性能指标对比曲线</div>
            <div class="charts-container">
                <div class="chart-item"><img src="https://rtvst-demo.github.io/video-transmission-demo/images_metrics/psnr.svg" alt="PSNR"><div class="chart-label">PSNR性能对比</div></div>
                <div class="chart-item"><img src="https://rtvst-demo.github.io/video-transmission-demo/images_metrics/ssim.svg" alt="SSIM"><div class="chart-label">SSIM性能对比</div></div>
                <div class="chart-item"><img src="https://rtvst-demo.github.io/video-transmission-demo/images_metrics/lpips.svg" alt="LPIPS"><div class="chart-label">LPIPS性能对比</div></div>
            </div>
            
            <div class="control-row">
                <div class="snr-selector">
                    <label for="snrSelect">选择SNR:</label>
                    <select id="snrSelect">
                        <option value="4">4 dB</option>
                        <option value="8" selected>8 dB</option>
                        <option value="12">12 dB</option>
                    </select>
                </div>
                
                <div class="info-display-item">
                    <span class="info-label">CBR:</span>
                    <span class="info-value">0.012</span>
                </div>
            </div> 
            
            <div class="controls">
                <button class="btn btn-global" id="globalPlay"><i class="fas fa-play"></i> 开始</button>
                <button class="btn btn-global" id="globalPause"><i class="fas fa-pause"></i> 暂停</button>
                <button class="btn btn-global btn-stop" id="globalStop"><i class="fas fa-stop"></i> 停止</button>
            </div>
        </div>

        <div class="video-container">
            <!-- Origin -->
            <div class="video-panel">
                <div class="panel-header"><h3 class="panel-title"><i class="fas fa-film"></i> Origin</h3><span class="status-indicator status-stopped" id="st4"></span></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span style="font-size: 15px; color: #000;">加载进度</span>
                    <span style="font-size: 15px; color: #fdbb2d;" id="load-text4"></span>
                </div>
                <div class="progress-bar-container" style="margin-bottom: 5px;">
                    <div class="progress-bar" id="lb4"></div> 
                </div>
                <div class="display-area" id="da4"></div>
                <div class="info-panel">
                    <div class="info-item"><span>帧率:</span><span id="fps4">25 FPS</span></div>
                    <div class="info-item"><span>状态:</span><span id="ps4">已停止</span></div>
                </div>
            </div>

            <!-- H.265 + LDPC -->
            <div class="video-panel">
                <div class="panel-header"><h3 class="panel-title"><i class="fas fa-film"></i> H.265 + LDPC</h3><span class="status-indicator status-stopped" id="st1"></span></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span style="font-size: 15px; color: #000;">加载进度</span>
                    <span style="font-size: 15px; color: #fdbb2d;" id="load-text1"></span>
                </div>
                <div class="progress-bar-container" style="margin-bottom: 5px;">
                    <div class="progress-bar" id="lb1"></div> 
                </div>
                <div class="display-area" id="da1"></div>
                <div class="info-panel">
                    <div class="info-item"><span>帧率:</span><span id="fps1">25 FPS</span></div>
                    <div class="info-item"><span>状态:</span><span id="ps1">已停止</span></div>
                </div>
            </div>

            <!-- DeepJSCC -->
            <div class="video-panel">
                <div class="panel-header"><h3 class="panel-title"><i class="fas fa-film"></i> DeepJSCC</h3><span class="status-indicator status-stopped" id="st2"></span></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span style="font-size: 15px; color: #000;">加载进度</span>
                    <span style="font-size: 15px; color: #fdbb2d;" id="load-text2"></span>
                </div>
                <div class="progress-bar-container" style="margin-bottom: 5px;">
                    <div class="progress-bar" id="lb2"></div> 
                </div>
                <div class="display-area" id="da2"></div>
                <div class="info-panel">
                    <div class="info-item"><span>帧率:</span><span id="fps2">4 FPS</span></div>
                    <div class="info-item"><span>状态:</span><span id="ps2">已停止</span></div>
                </div>
            </div>

            <!-- RTVST -->
            <div class="video-panel">
                <div class="panel-header"><h3 class="panel-title"><i class="fas fa-film"></i> RTVST</h3><span class="status-indicator status-stopped" id="st3"></span></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span style="font-size: 15px; color: #000;">加载进度</span>
                    <span style="font-size: 15px; color: #fdbb2d;" id="load-text3"></span>
                </div>
                <div class="progress-bar-container" style="margin-bottom: 5px;">
                    <div class="progress-bar" id="lb3"></div> 
                </div>
                <div class="display-area" id="da3"></div>
                <div class="info-panel">
                    <div class="info-item"><span>帧率:</span><span id="fps3">25 FPS</span></div>
                    <div class="info-item"><span>状态:</span><span id="ps3">已停止</span></div>
                </div>
            </div>
        </div>

        <footer><p>实时视频语义传输算法设计</p></footer>
    </div>

    <script>
        /* ================= 配置不同SNR对应的完整路径 ================= */
        const snrConfig = {
            '4': {
                origin: 'origin-frames',
                h265: 'h265+ldpc-frames-4db', 
                deepjscc: 'deepjscc-frames-4db',
                rtvst: 'rtvst-frames-4db'
            },
            '8': {
                origin: 'origin-frames',
                h265: 'h265+ldpc-frames',
                deepjscc: 'deepjscc-frames',
                rtvst: 'rtvst-frames'
            },
            '12': {
                origin: 'origin-frames',
                h265: 'h265+ldpc-frames-12db',
                deepjscc: 'deepjscc-frames-12db',
                rtvst: 'rtvst-frames-12db'
            }
        };
        
        const repo = 'https://rtvst-demo.github.io/video-transmission-demo';
        let currentPlayers = [];
        let currentSnr = '8';
        
        // 图片缓存 - 存储所有已加载的图片
        const imageCache = new Map();
        
        /* ================= 初始化页面 ================= */
        function initializePage() {
            setupEventListeners();
            
            // 初始显示
            document.querySelectorAll('[id^="ps"]').forEach(el => {
                el.textContent = '请选择SNR';
            });
            
            document.querySelectorAll('[id^="da"]').forEach(container => {
                container.innerHTML = '<div class="placeholder">请选择SNR开始加载视频</div>';
            });
            
            // 默认加载8dB的视频
            loadVideos(currentSnr);
        }
        
        /* ================= 加载视频帧 - 优化版本 ================= */
        function loadVideos(snr) {
            const config = snrConfig[snr];
            
            const panels = [
                { 
                    id: 'da4', 
                    folder: config.origin,
                    tpl: i => `img${String(i).padStart(6,'0')}.png`, 
                    count: 100, 
                    fps: 25, 
                    loadBarId: 'lb4',
                    loadTextId: 'load-text4',
                    statusId: 'ps4',
                    indicatorId: 'st4'
                },
                { 
                    id: 'da1', 
                    folder: config.h265,
                    tpl: i => `output_${String(i).padStart(4,'0')}.png`, 
                    count: 100, 
                    fps: 25, 
                    loadBarId: 'lb1',
                    loadTextId: 'load-text1',
                    statusId: 'ps1',
                    indicatorId: 'st1'
                },
                { 
                    id: 'da2', 
                    folder: config.deepjscc,
                    tpl: i => `${i-1}recon_snr${snr}.png`,
                    count: 100, 
                    fps: 4, 
                    loadBarId: 'lb2',
                    loadTextId: 'load-text2',
                    statusId: 'ps2',
                    indicatorId: 'st2'
                },
                { 
                    id: 'da3', 
                    folder: config.rtvst,
                    tpl: i => `${i-1}recon_snr${snr}.png`,
                    count: 100, 
                    fps: 25, 
                    loadBarId: 'lb3',
                    loadTextId: 'load-text3',
                    statusId: 'ps3',
                    indicatorId: 'st3'
                }
            ];
        
            // 清除现有的显示内容
            panels.forEach(p => {
                const box = document.getElementById(p.id);
                box.innerHTML = '';
            });
        
            // 重置UI状态
            resetUIState(panels);
        
            // 使用优化的加载方法
            loadVideoFramesOptimized(panels, snr);
        }
        
        /* ================= 重置UI状态 ================= */
        function resetUIState(panels) {
            // 重置进度条
            document.querySelectorAll('.progress-bar').forEach(bar => {
                bar.style.width = '0%';
            });
            
            // 重置加载文本
            panels.forEach(p => {
                const loadText = document.getElementById(p.loadTextId);
                if (loadText) loadText.textContent = '0%';
            });
            
            // 重置状态显示
            panels.forEach(p => {
                const statusEl = document.getElementById(p.statusId);
                if (statusEl) statusEl.textContent = '加载中...';
            });
            
            // 重置状态指示器
            document.querySelectorAll('.status-indicator').forEach(indicator => {
                indicator.className = 'status-indicator status-stopped';
            });
        }
        
        /* ================= 优化的图片加载方法 ================= */
        function loadVideoFramesOptimized(panels, snr) {
            let totalLoadedPanels = 0;
            
            panels.forEach(p => {
                const box = document.getElementById(p.id);
                const loadBar = document.getElementById(p.loadBarId);
                const loadText = document.getElementById(p.loadTextId);
                
                let loadedFrames = 0;
                const totalFrames = p.count;
                
                // 批量加载图片
                for(let i = 1; i <= totalFrames; i++) {
                    const fileName = p.tpl(i);
                    const src = `${repo}/${p.folder}/${fileName}`;
                    const cacheKey = `${snr}_${p.folder}_${fileName}`;
                    
                    // 创建图片元素
                    const img = document.createElement('img');
                    img.id = `${p.id}-frame-${i}`;
                    img.style.display = 'none';
                    
                    // 检查缓存
                    if (imageCache.has(cacheKey)) {
                        // 使用缓存的图片数据
                        const cachedData = imageCache.get(cacheKey);
                        img.src = cachedData;
                        handleFrameLoaded();
                    } else {
                        // 加载新图片
                        img.src = src;
                        img.onload = () => {
                            // 缓存图片URL
                            imageCache.set(cacheKey, src);
                            handleFrameLoaded();
                        };
                        img.onerror = () => {
                            console.error(`加载失败: ${src}`);
                            handleFrameLoaded();
                        };
                    }
                    
                    box.appendChild(img);
                    
                    function handleFrameLoaded() {
                        loadedFrames++;
                        const progress = Math.round((loadedFrames / totalFrames) * 100);
                        
                        // 更新进度
                        if (loadBar) loadBar.style.width = `${progress}%`;
                        if (loadText) loadText.textContent = `${progress}%`;
                        
                        // 当所有帧加载完成
                        if (loadedFrames === totalFrames) {
                            totalLoadedPanels++;
                            
                            // 显示第一帧
                            const firstFrame = document.getElementById(`${p.id}-frame-1`);
                            if (firstFrame) firstFrame.style.display = 'block';
                            
                            // 更新状态
                            const statusEl = document.getElementById(p.statusId);
                            if (statusEl) statusEl.textContent = '加载完成';
                            
                            // 当所有面板都加载完成
                            if (totalLoadedPanels === panels.length) {
                                initializePlayers(panels);
                            }
                        }
                    }
                }
            });
        }
        
        /* ================= 停止所有播放器 ================= */
        function stopAllPlayers() {
            currentPlayers.forEach(player => {
                if(player) player.stop();
            });
            currentPlayers = [];
        }

        /* ================= 初始化播放器 ================= */
        function initializePlayers(panels) {
            stopAllPlayers();

            currentPlayers = panels.map((p) => {
                return createPlayer(
                    p.id, 
                    p.count, 
                    1000/p.fps,
                    document.getElementById(p.statusId),
                    document.getElementById(p.indicatorId)
                );
            });
        }

        /* ================= 播放器函数 ================= */
        function createPlayer(prefix, total, interval, statusEl, statusIndicator) { 
            let idx = 0, t = null;
            
            const showFrame = k => {
                const frames = document.querySelectorAll(`[id^="${prefix}-frame-"]`);
                const target = document.getElementById(`${prefix}-frame-${k+1}`);
                
                requestAnimationFrame(() => {
                    frames.forEach(el => el.style.display = 'none');
                    if(target) target.style.display = 'block';
                });
            };
            
            showFrame(0);
            
            return {
                start() {
                    if(t) return;
                    if(statusEl) statusEl.textContent = '播放中';
                    if(statusIndicator) statusIndicator.className = 'status-indicator status-playing';
                    
                    t = setInterval(() => { 
                        idx = (idx + 1) % total; 
                        showFrame(idx); 
                    }, interval);
                },
                pause() {
                    clearInterval(t); 
                    t = null;
                    if(statusEl) statusEl.textContent = '已暂停';
                    if(statusIndicator) statusIndicator.className = 'status-indicator status-paused';
                },
                stop() {
                    clearInterval(t); 
                    t = null; 
                    idx = 0; 
                    showFrame(0);
                    if(statusEl) statusEl.textContent = '已停止';
                    if(statusIndicator) statusIndicator.className = 'status-indicator status-stopped';
                }
            };
        }

        /* ================= 事件监听器设置 ================= */
        function setupEventListeners() {
            // SNR选择器事件
            document.getElementById('snrSelect').addEventListener('change', function(e) {
                const selectedSnr = e.target.value;
                if (selectedSnr) {
                    stopAllPlayers();
                    currentSnr = selectedSnr;
                    loadVideos(currentSnr);
                }
            });

            // 全局控制按钮事件
            document.getElementById('globalPlay').addEventListener('click', () => {
                currentPlayers.forEach(p => p && p.start());
            });
            document.getElementById('globalPause').addEventListener('click', () => {
                currentPlayers.forEach(p => p && p.pause());
            });
            document.getElementById('globalStop').addEventListener('click', () => {
                currentPlayers.forEach(p => p && p.stop());
            });
        }

        /* ================= 页面加载完成后初始化 ================= */
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
