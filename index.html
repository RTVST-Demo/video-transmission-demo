<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AIC-RTVSTï½œå®žæ—¶è§†é¢‘è¯­ä¹‰ä¼ è¾“å¯¹æ¯”æ¼”ç¤º</title>

    <!-- å­—ä½“å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #111;
            color: #fff;
            overflow-x: hidden;
        }
        header {
            text-align: center;
            padding: 20px 0;
            background: #1a1a1a;
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 1px;
            border-bottom: 2px solid #333;
        }
        .snr-buttons {
            text-align: center;
            margin: 15px 0;
        }
        .snr-buttons button {
            margin: 0 8px;
            padding: 8px 16px;
            background: #444;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 6px;
        }
        .snr-buttons button.active {
            background: #ff9800;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 10px;
        }
        .panel {
            background: #1a1a1a;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .panel h3 {
            text-align: center;
            margin: 6px 0;
            font-size: 16px;
        }
        .panel img {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 6px;
            background: #000;
        }
    </style>
</head>

<body>

<header>å®žæ—¶è§†é¢‘è¯­ä¹‰ä¼ è¾“å¯¹æ¯”å±•ç¤ºï¼ˆè¶…å¿«é€Ÿç‰ˆï¼‰</header>

<!-- SNR åˆ‡æ¢ -->
<div class="snr-buttons">
    <button data-snr="30" class="active">30 dB</button>
    <button data-snr="20">20 dB</button>
    <button data-snr="10">10 dB</button>
    <button data-snr="5">5 dB</button>
</div>

<!-- å››ä¸ªé€šé“çš„å›¾åƒæ˜¾ç¤º -->
<div class="video-grid">
    <div class="panel"><h3>Original</h3><img id="img-original"></div>
    <div class="panel"><h3>Processed</h3><img id="img-processed"></div>
    <div class="panel"><h3>Semantic</h3><img id="img-semantic"></div>
    <div class="panel"><h3>DeepJSCC</h3><img id="img-deepjscc"></div>
</div>

<script>
/* -----------------------------
   ðŸš€ 1. é…ç½®è·¯å¾„ï¼ˆç…§ä½ æœåŠ¡å™¨ç»“æž„ï¼‰
------------------------------ */
const BASE_PATH = "http://10.12.35.32:8000";
const STREAMS = ["original", "processed", "semantic", "deepjscc"];
const DEFAULT_SNR = "30";

/* -----------------------------
   ðŸš€ 2. ç¼“å­˜é¢„åŠ è½½ï¼ˆä¸€æ¬¡åŠ è½½ï¼Œç§’é€Ÿåˆ‡æ¢ï¼‰
------------------------------ */
const cache = {};  // { "30": { original:[], ... } }
const preloadedCount = {}; // è®¡æ•°å™¨ç”¨äºŽæ˜¾ç¤ºåŠ è½½è¿›åº¦

async function preloadImagesForSNR(snr) {
    if (cache[snr]) return;   // å·²åŠ è½½è¿‡

    cache[snr] = {};
    preloadedCount[snr] = 0;

    const loadPromises = [];

    STREAMS.forEach(stream => {
        cache[snr][stream] = [];
        for (let i = 0; i < 300; i++) {
            const url = `${BASE_PATH}/frames/${snr}/${stream}/${String(i).padStart(3, "0")}.jpg`;

            const promise = new Promise(resolve => {
                const img = new Image();
                img.src = url;

                img.onload = () => {
                    cache[snr][stream].push(img);
                    preloadedCount[snr]++;
                    resolve();
                };
                img.onerror = resolve;
            });

            loadPromises.push(promise);
        }
    });

    await Promise.all(loadPromises);
    console.log(`SNR ${snr} é¢„åŠ è½½å®Œæˆ: ${preloadedCount[snr]} å¼ `);
}

/* -----------------------------
   ðŸš€ 3. æ˜¾ç¤ºå™¨ï¼ˆæ¯ 33ms åˆ·æ–°ä¸€å¸§ï¼‰
------------------------------ */
let currentSNR = DEFAULT_SNR;
let frameIndex = 0;

function displayFrame() {
    const snrCache = cache[currentSNR];
    if (!snrCache) return;

    // æ‰¹é‡ DOM æ›´æ–°ï¼ˆä¸€æ¬¡æ€§å†™å…¥ï¼Œæžå¿«ï¼‰
    imgOriginal.src = snrCache.original[frameIndex].src;
    imgProcessed.src = snrCache.processed[frameIndex].src;
    imgSemantic.src = snrCache.semantic[frameIndex].src;
    imgDeepjscc.src = snrCache.deepjscc[frameIndex].src;

    frameIndex = (frameIndex + 1) % 300;
}

setInterval(displayFrame, 33);

/* -----------------------------
   ðŸš€ 4. SNR é€‰æ‹©æŒ‰é’®
------------------------------ */
document.querySelectorAll(".snr-buttons button").forEach(btn => {
    btn.addEventListener("click", async () => {
        document.querySelector(".snr-buttons button.active").classList.remove("active");
        btn.classList.add("active");

        const newSNR = btn.dataset.snr;

        // è‹¥æœªåŠ è½½ï¼Œå…ˆå¹¶è¡ŒåŠ è½½
        if (!cache[newSNR]) {
            console.log(`å¼€å§‹é¢„åŠ è½½ SNR ${newSNR}...`);
            await preloadImagesForSNR(newSNR);
        }

        currentSNR = newSNR;
        frameIndex = 0;  // ä»Ž 0 å¸§é‡å¯
    });
});

/* -----------------------------
   ðŸš€ 5. é¡µé¢å¯åŠ¨ï¼šé¢„åŠ è½½é»˜è®¤ SNR
------------------------------ */
window.onload = () => preloadImagesForSNR(DEFAULT_SNR);
</script>

</body>
</html>
